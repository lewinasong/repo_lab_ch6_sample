@RestController
@RequestMapping("/api/programs")
public class ProgramExecutionController {

    @Autowired
    private ProgramExecutionService programExecutionService;

    @Autowired
    private ProgramStatusService programStatusService;

    // 직원의 프로그램 실행 요청 API
    @PostMapping("/execute/{empNo}")
    public ResponseEntity<String> executePrograms(@PathVariable String empNo) {
        try {
            programExecutionService.executeProgramsForEmployee(empNo);
            return ResponseEntity.ok("프로그램 실행 완료");
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body("프로그램 실행 실패: " + e.getMessage());
        }
    }

    // 프로그램 실행 순서 변경 API
    @PostMapping("/updateOrder/{empNo}")
    public ResponseEntity<String> updateProgramExecutionOrder(
            @PathVariable String empNo, @RequestBody List<String> newOrder) {
        try {
            programExecutionService.updateProgramExecutionOrder(empNo, newOrder);
            return ResponseEntity.ok("실행 순서 변경 완료");
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body("실행 순서 변경 실패: " + e.getMessage());
        }
    }

    // 프로그램 상태 업데이트 API
    @PostMapping("/status")
    public ResponseEntity<String> updateProgramStatus(@RequestBody ProgramStatusDto statusDto) {
        try {
            Integer userId = statusDto.getUserId();
            Integer programId = statusDto.getProgramId();
            Integer status = statusDto.getStatus();  // 1 is normal, 0 is abnormal

            programStatusService.updateStatus(userId, programId, status);
            return ResponseEntity.ok("프로그램 상태 업데이트 완료");
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body("프로그램 상태 업데이트 실패: " + e.getMessage());
        }
    }

    // 프로그램 상태 DTO 클래스
    static class ProgramStatusDto {
        private Integer userId;
        private Integer programId;
        private Integer status; // 1 is normal, 0 is abnormal

        public Integer getUserId() {
            return userId;
        }

        public void setUserId(Integer userId) {
            this.userId = userId;
        }

        public Integer getProgramId() {
            return programId;
        }

        public void setProgramId(Integer programId) {
            this.programId = programId;
        }

        public Integer getStatus() {
            return status;
        }

        public void setStatus(Integer status) {
            this.status = status;
        }
    }
}
